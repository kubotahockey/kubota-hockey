{% extends 'base.html' %}

{% block title %}{{ team_name }} Insights{% endblock %}

{% block content %}
<div class="team-insights">
    <div class="team-header d-flex align-items-center">
        <img src="{{ team_logo }}" alt="{{ team_name }} Logo" class="team-logo">
        <h1>{{ team_name }} Insights</h1>
    </div>
    <hr>
    <div class="team-stats">
        <h3>Total Team Stats</h3>
        <p>Games Played: {{ team_stats['GPNEW'] }}</p>
        <p>Goals: {{ team_stats['G_GP'] }}</p>
        <p>Assists: {{ team_stats['A_GP'] }}</p>
        <p>Points: {{ team_stats['PTS_GP'] }}</p>
        <p>Penalty Minutes: {{ team_stats['PIM_GP'] }}</p>
    </div>
    <hr>
    <div class="leaderboard">
        <h3>Player Leaderboard (Sorted by Points)</h3>
        <table class="table table-dark table-striped">
            <thead>
                <tr>
                    <th>Player</th>
                    <th>Games Played</th>
                    <th>Goals</th>
                    <th>Assists</th>
                    <th>Points</th>
                    <th>Penalty Minutes</th>
                </tr>
            </thead>
            <tbody>
                {% for player in leaderboard_data %}
                <tr>
                    <td><a href="{{ url_for('player_page', player=player['name']) }}">{{ player['name'] }}</a></td>
                    <td>{{ player['GPNEW'] }}</td>
                    <td>{{ player['G_GP'] }}</td>
                    <td>{{ player['A_GP'] }}</td>
                    <td>{{ player['PTS_GP'] }}</td>
                    <td>{{ player['PIM_GP'] }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <hr>
    <div class="player-projections">
        <h3>7-Year Points Projection</h3>
        <canvas id="teamProjectionsChart"></canvas>
    </div>
</div>

<script>
    const ctx = document.getElementById('teamProjectionsChart').getContext('2d');
    const labels = ['Year 1', 'Year 2', 'Year 3', 'Year 4', 'Year 5', 'Year 6', 'Year 7'];
    const data = {
        labels: labels,
        datasets: [{
            label: '{{ team_name }} Projections',
            data: {{ pts_projections.tolist() }},
            borderColor: 'rgba(75, 192, 192, 1)',
            borderWidth: 2,
            fill: false,
            tension: 0.4,
        }]
    };
    new Chart(ctx, {
        type: 'line',
        data: data,
        options: {
            scales: {
                y: {
                    beginAtZero: true,
                }
            }
        }
    });
</script>
{% endblock %}